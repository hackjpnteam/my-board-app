# API仕様書

## 1. API概要

### 1.1 基本情報
- **フレームワーク**: Next.js 15.4.5 API Routes
- **データ形式**: JSON
- **認証**: なし（現在の実装）
- **エラーハンドリング**: HTTPステータスコード + JSONエラーメッセージ

### 1.2 共通仕様
- **Content-Type**: application/json
- **文字エンコーディング**: UTF-8
- **レスポンス形式**: JSON
- **エラー形式**: `{ "error": "エラーメッセージ" }`

## 2. 投稿一覧取得API

### 2.1 基本情報
- **エンドポイント**: `GET /api/posts`
- **ファイル**: `src/app/api/posts/route.ts`
- **説明**: 全ての投稿を新着順で取得

### 2.2 リクエスト
- **メソッド**: GET
- **パラメータ**: なし
- **ヘッダー**: なし

### 2.3 レスポンス

#### 2.3.1 成功時（200 OK）
```json
[
  {
    "_id": "6891b9db09a7a65c7a3c199d",
    "content": "投稿内容",
    "createdAt": "2025-08-05T07:59:23.247Z",
    "updatedAt": "2025-08-05T07:59:23.247Z",
    "__v": 0
  }
]
```

#### 2.3.2 エラー時（500 Internal Server Error）
```json
{
  "error": "投稿の取得に失敗しました"
}
```

## 3. 投稿作成API

### 3.1 基本情報
- **エンドポイント**: `POST /api/posts`
- **ファイル**: `src/app/api/posts/route.ts`
- **説明**: 新しい投稿を作成

### 3.2 リクエスト
- **メソッド**: POST
- **Content-Type**: application/json
- **ボディ**:
```json
{
  "content": "投稿内容"
}
```

### 3.3 レスポンス

#### 3.3.1 成功時（201 Created）
```json
{
  "_id": "6891b9db09a7a65c7a3c199d",
  "content": "投稿内容",
  "createdAt": "2025-08-05T07:59:23.247Z",
  "updatedAt": "2025-08-05T07:59:23.247Z",
  "__v": 0
}
```

#### 3.3.2 バリデーションエラー時（400 Bad Request）
```json
{
  "error": "投稿内容を入力してください"
}
```

### 3.4 バリデーション
- **content**: 必須、文字列、200文字以内
- **空文字チェック**: 空白文字のみは無効

## 4. 投稿取得API

### 4.1 基本情報
- **エンドポイント**: `GET /api/posts/[id]`
- **ファイル**: `src/app/api/posts/[id]/route.ts`
- **説明**: 指定されたIDの投稿を取得

### 4.2 リクエスト
- **メソッド**: GET
- **パラメータ**: 
  - `id`: 投稿ID（MongoDB ObjectId）

### 4.3 レスポンス

#### 4.3.1 成功時（200 OK）
```json
{
  "_id": "6891b9db09a7a65c7a3c199d",
  "content": "投稿内容",
  "createdAt": "2025-08-05T07:59:23.247Z",
  "updatedAt": "2025-08-05T07:59:23.247Z",
  "__v": 0
}
```

#### 4.3.2 無効なID時（400 Bad Request）
```json
{
  "error": "無効なIDです"
}
```

## 5. 投稿更新API

### 5.1 基本情報
- **エンドポイント**: `PUT /api/posts/[id]`
- **ファイル**: `src/app/api/posts/[id]/route.ts`
- **説明**: 指定されたIDの投稿を更新

### 5.2 リクエスト
- **メソッド**: PUT
- **Content-Type**: application/json
- **パラメータ**: 
  - `id`: 投稿ID（MongoDB ObjectId）
- **ボディ**:
```json
{
  "content": "更新された投稿内容"
}
```

### 5.3 レスポンス

#### 5.3.1 成功時（200 OK）
```json
{
  "_id": "6891b9db09a7a65c7a3c199d",
  "content": "更新された投稿内容",
  "createdAt": "2025-08-05T07:59:23.247Z",
  "updatedAt": "2025-08-05T08:30:15.123Z",
  "__v": 0
}
```

## 6. 投稿削除API

### 6.1 基本情報
- **エンドポイント**: `DELETE /api/posts/[id]`
- **ファイル**: `src/app/api/posts/[id]/route.ts`
- **説明**: 指定されたIDの投稿を削除

### 6.2 リクエスト
- **メソッド**: DELETE
- **パラメータ**: 
  - `id`: 投稿ID（MongoDB ObjectId）

### 6.3 レスポンス

#### 6.3.1 成功時（200 OK）
```json
{
  "message": "投稿を削除しました"
}
```

## 7. エラーハンドリング

### 7.1 共通エラーレスポンス
- **形式**: `{ "error": "エラーメッセージ" }`
- **ログ出力**: console.errorでサーバーサイドにログ出力

### 7.2 HTTPステータスコード
- **200**: 成功（GET、PUT、DELETE）
- **201**: 作成成功（POST）
- **400**: バリデーションエラー、無効なID
- **404**: リソースが見つからない
- **500**: サーバーエラー

### 7.3 バリデーション
- **必須チェック**: 空文字、null、undefined
- **文字数チェック**: 200文字以内
- **ID形式チェック**: MongoDB ObjectId形式 